general:
  buildTool: npm
  productiveBranch: main

stages:
  # 1️⃣ Build the project (generate gen/*, build UI, etc.)
  Build:
    npmExecuteScripts: true

  # 2️⃣ Containerize build outputs using Cloud Native Buildpacks
  Containerize:
    cnbBuild: true

steps:
  # --- Step 1: Build Phase ---
  npmExecuteScripts:
    install: true                # Ensures dependencies are installed before build
    runScripts:
      - "production-build"       # runs: cds build --production → creates gen/srv, gen/db
      - "ui-build"               # builds UI and packages html5 app

  # --- Step 2: Container Build Phase ---
  cnbBuild:
    containerImageTag: latest
    containerRegistryUrl: "content-agent.common.repositories.cloud.sap"
    multipleImages:
      - containerImageName: incidents-jenkins-srv
        path: gen/srv
      - containerImageName: incidents-jenkins-hana-deployer
        path: gen/db
      - containerImageName: incidents-jenkins-html5-deployer
        path: app/html5-deployer
        buildpacks:
          - "deploy-releases-hyperspace-docker.common.repositories.sapcloud.cn/buildpacks/application-content-deployer-buildpack:1.1.0"

  # --- Step 3: Git tagging/version handling ---
  artifactPrepareVersion:
    gitSshKeyCredentialsId: 'gitSshKeyCredentialsId'
